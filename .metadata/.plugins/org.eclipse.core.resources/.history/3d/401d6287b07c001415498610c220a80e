/*
 * bjr2.java
 * http://villa7.github.io
 *
 * Copyright (C) 2014-2014 Theodore Kluge
 */

package card_games;

import java.util.*;
import villa7.Print;

public class bjr2 {
	
	private static double ver = 1.1;
	
	private static int suit;
	private static int value;
	private static int computerCard, userCard, aiCard;
	private static int numPlayers = 0, numAI = 0;
	private static Print p = new Print();
	private static BlackjackHand hand = new BlackjackHand();
	private static Scanner s = new Scanner(System.in);
	private static String[] players;
	private static ArrayList<String> winners = new ArrayList<String>();

	private static boolean playerTurn = true, aiTurn = true, computerTurn = true;
	private static boolean running = true;
	private static boolean[] isFirstTurn, isAIFT;
	
	private static int userTotal[],
					   aiTotal[],
					   computerTotal;
	
	public static void main(String[] args) {
		
		p.nl("BlackjackGame v" + ver);
		p.nl();
		p.nl("Number of players (1 - 6):");
		do {
			numPlayers = s.nextInt();
		} while (numPlayers <= 0 || numPlayers > 6);

		players = new String[numPlayers];

		for (int i = 0; i < numPlayers; i++) {
			p.nl("Enter name of player " + (i + 1));
			String n = s.next();
			players[i] = n;
			isFirstTurn[i] = true;
			isAIFT[i] = true;
			if (n.equalsIgnoreCase("AI") || n.trim().equals(""))
				numAI++; 
		}
		
		while (running) {
			hand.newDeck(52);
			hand.newUsedDeck(52);
			
			if (playBlackjack()) {
				int numWinners = 0;
				for (String s : winners) {
					numWinners++;
				}
				p.nl("You win.");
				p.nl("You had a value of " + userTotal);
				p.nl("The dealer had a value of " + computerTotal);
			} else {
				p.nl("You lose.");
				p.nl("You had a value of " + userTotal);
				//p.nl("The dealer had a value of " + computerTotal);
			}
			p.nbsp(3);
		}
	}
	
	private static boolean playBlackjack() {
		userTotal = new int[numPlayers - numAI];
		aiTotal = new int[numAI];
		computerTotal = 0;
		playerTurn = true;
		aiTurn = true;
		computerTurn = true;
		
		//draw 2 cards to start
		for (int i = 0; i < numPlayers - numAI; i++) {	
			userTotal[i] += hand.drawRandomCard();
			userTotal[i] += hand.drawRandomCard();
		}
		for (int i = 0; i < numAI; i++) {
			aiTotal[i] += hand.drawRandomCard();
			aiTotal[i] += hand.drawRandomCard();
		}
		computerTotal += hand.drawRandomCard();
		p.nl("The dealer has a " + computerTotal + " and an unknown card.");
		computerTotal += hand.drawRandomCard();
		
		while(true) {
			
			for (int i = 0; i < numPlayers - numAI; i++) {
				isFirstTurn = true;
				while (playerTurn) {
					
					while (userTotal[i] > 21 && isFirstTurn) {
						//playerTurn = false;
						//p.nl("Sorry, redrawing...");
						userTotal[i] = 0;
						userTotal[i] += hand.drawRandomCard();
						userTotal[i] += hand.drawRandomCard();
					}
					p.nl("Your cards add up to " + userTotal[i]);
					
					p.nl("Enter an action: [hit | stand]");
					String userAction = s.next();
					
					if(userAction.equalsIgnoreCase("quit")) {
						running = false;
						return false;
					} else if (userAction.equalsIgnoreCase("hit")) {
						userCard = hand.drawRandomCard();
						p.nl("You hit.");
						p.nl("You drew a " + userCard);
						userTotal[i] += userCard;
						p.nl("Your total is " + userTotal[i]);
						if (userTotal[i] > 21) {
							playerTurn = false;
						}
					} else if (userAction.equalsIgnoreCase("stand")) {
						p.nl("You stand.");
						playerTurn = false;
					} else {
						p.nl("Please enter a valid action. [hit | stand]");
					}
					isFirstTurn = false;
				}
			}
			for (int i = 0; i < numAI; i++) {
				isAIFT = true;
				while(aiTurn) {
					while (aiTotal[i] > 21 && isAIFT) {
						aiTotal[i] = 0;
						aiTotal[i] += hand.drawRandomCard();
						aiTotal[i] += hand.drawRandomCard();
					}
					if (aiTotal[i] < 17) { //AI uses the dealer's logic
						aiCard = hand.drawRandomCard();
						p.nl("AI #" + i + " drew " + aiCard);
						aiTotal[i] += aiCard;
					} else {
						p.nl("AI #" + i + " stands.");
						aiTurn = false;
					}
					isAIFT = false;
				}
			}
			
			//Dumb AI
			while (computerTurn) {
				if (computerTotal == 21) { //if dealer has 21, he wins
					for (int i = 0; i < numPlayers - numAI; i++) {
						if (userTotal[i] == 21) { //unless player also has 21
							winners.add(players[i]);
						}
					}
					for (int i = 0; i < numAI; i++) {
						if (aiTotal[i] == 21) {
							winners.add(players[numPlayers + i] + " #" + i);
						}
					}
					if (winners.size() > 0) { //if there is at least one winner
						computerTurn = false;
						return true;
					} else {
						return false;
					}
				} else if (computerTotal < 17) {
					computerCard = hand.drawRandomCard();
					p.nl("Dealer drew " + computerCard);
					computerTotal += computerCard;
				} else {
					p.nl("Dealer stands.");
					for (int i = 0; i < numPlayers - numAI; i++) {
						if (userTotal[i] > computerTotal) {
							winners.add(players[i]);
						}
					}
					for (int i = 0; i < numAI; i++) {
						if (aiTotal[i] > computerTotal) {
							winners.add(players[numPlayers + i] + " #" + i);
						}
					}
					if (winners.size() > 0) {
						computerTurn = false;
						return true;
					} else {
						return false;
					}
				}
			}
			
			//win logic
			if (computerTotal > 21) {
				return true; //what happens if dealer loses?
			}	
		}
	}
}
